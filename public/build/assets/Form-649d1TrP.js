import{r as b,j as e,u as L,H as P,L as $,z as k}from"./app-9nS-Mm4e.js";import{L as f}from"./leaflet-rhc4qf6L.js";import{B as C}from"./Button-DtSZ5ZSY.js";import{C as _,b as y,c as w,a as S}from"./Card-gbBR4fyZ.js";import{u as A}from"./useAOS-Dj5LRxol.js";import{A as E}from"./AdminLayout-DPSUws_u.js";import{A as I}from"./arrow-left-aaF1DPWt.js";import{M as R}from"./map-pin-D-MawlvD.js";import"./createLucideIcon-oTywQYJd.js";import"./users-DE606EQy.js";import"./x-BqjMX6yR.js";import"./graduation-cap-8JamamWt.js";delete f.Icon.Default.prototype._getIconUrl;f.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});function B({latitude:t,longitude:d,onLocationChange:p,height:m="400px",sekolahs:x=[]}){const n=b.useRef(null),s=b.useRef(null),h=b.useRef(null),j=b.useRef([]),[g,a]=b.useState(!1),F=-2.5333,v=140.7167,l=t&&parseFloat(t)?parseFloat(t):F,u=d&&parseFloat(d)?parseFloat(d):v;return b.useEffect(()=>{if(!n.current||s.current)return;const r=f.map(n.current,{zoomControl:!0}).setView([l,u],13);f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(r);const i=f.marker([l,u],{draggable:!0,autoPan:!0}).addTo(r);return i.bindPopup(`Koordinat: ${l.toFixed(6)}, ${u.toFixed(6)}`).openPopup(),i.on("dragend",function(o){const c=i.getLatLng();i.setPopupContent(`Koordinat: ${c.lat.toFixed(6)}, ${c.lng.toFixed(6)}`).openPopup(),p&&p(c.lat,c.lng)}),r.on("click",function(o){const{lat:c,lng:N}=o.latlng;i.setLatLng([c,N]),i.setPopupContent(`Koordinat: ${c.toFixed(6)}, ${N.toFixed(6)}`).openPopup(),p&&p(c,N)}),s.current=r,h.current=i,a(!0),()=>{s.current&&j.current.forEach(o=>{o&&s.current.removeLayer(o)}),j.current=[],s.current&&(s.current.remove(),s.current=null,h.current=null)}},[]),b.useEffect(()=>{!g||!s.current||!x||x.length===0||(j.current.forEach(r=>{r&&s.current.removeLayer(r)}),j.current=[],x.forEach(r=>{const i=parseFloat(r.latitude),o=parseFloat(r.longitude);if(isNaN(i)||isNaN(o))return;const c=f.divIcon({className:"custom-marker-sekolah",html:`<div style="
                    background-color: #3b82f6;
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    border: 3px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
                    position: relative;
                "></div>`,iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,-10]}),N=f.marker([i,o],{icon:c,zIndexOffset:-100}).addTo(s.current),M=`
                <div style="min-width: 150px;">
                    <strong>${r.nm_sekolah||"Sekolah"}</strong>
                    ${r.alamat?`<br><small>${r.alamat}</small>`:""}
                </div>
            `;N.bindPopup(M),j.current.push(N)}))},[x,g]),b.useEffect(()=>{if(g&&h.current&&s.current){const r=t&&parseFloat(t)?parseFloat(t):null,i=d&&parseFloat(d)?parseFloat(d):null;if(r!==null&&i!==null){const o=h.current.getLatLng();(Math.abs(o.lat-r)>1e-4||Math.abs(o.lng-i)>1e-4)&&(h.current.setLatLng([r,i]),h.current.setPopupContent(`Koordinat: ${r.toFixed(6)}, ${i.toFixed(6)}`),s.current.setView([r,i],s.current.getZoom()))}}},[t,d,g]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                .custom-marker-sekolah {
                    background: transparent !important;
                    border: none !important;
                }
            `}),e.jsx("div",{className:"w-full overflow-hidden rounded-lg border border-base-300",style:{height:m},children:e.jsx("div",{ref:n,className:"z-0 h-full w-full",style:{height:m}})})]})}function Y({sekolah:t=null,kelurahans:d=[],sekolahs:p=[]}){A();const m=!!t,x=t?.id,{data:n,setData:s,post:h,put:j,processing:g,errors:a}=L({npsn:t?.npsn||"",nm_sekolah:t?.nm_sekolah||"",id_kelurahan:t?.id_kelurahan||"",alamat:t?.alamat||"",no_telp:t?.no_telp||"",email:t?.email||"",website:t?.website||"",latitude:t?.latitude||"",longitude:t?.longitude||"",thn_berdiri:t?.thn_berdiri||"",status_sekolah:t?.status_sekolah||"aktif",akreditasi:t?.akreditasi||"Belum",tgl_akreditasi:t?.tgl_akreditasi||"",ket:t?.ket||"",foto_utama:t?.foto_utama||""}),F=l=>{if(l.preventDefault(),m){const u=typeof route=="function"&&route("admin.sekolah.update",x)&&route("admin.sekolah.update",x)!=="#"||`/admin/sekolah/${x}`,r=k.loading("Memperbarui sekolah...",{duration:1/0});j(u,{preserveScroll:!1,onSuccess:()=>{k.dismiss(r)},onError:i=>{const o=i&&Object.keys(i).length>0?"Gagal memperbarui sekolah. Periksa form Anda.":"Gagal memperbarui sekolah";k.error(o,{id:r,duration:5e3})}})}else{const u=typeof route=="function"&&route("admin.sekolah.store")&&route("admin.sekolah.store")!=="#"||"/admin/sekolah",r=k.loading("Menyimpan sekolah...",{duration:1/0});h(u,{preserveScroll:!1,onSuccess:()=>{k.dismiss(r)},onError:i=>{const o=i&&Object.keys(i).length>0?"Gagal menambahkan sekolah. Periksa form Anda.":"Gagal menambahkan sekolah";k.error(o,{id:r,duration:5e3})}})}},v=typeof route=="function"&&route("admin.sekolah.index")&&route("admin.sekolah.index")!=="#"||"/admin/sekolah";return e.jsxs(E,{title:m?"Edit Sekolah":"Tambah Sekolah",children:[e.jsx(P,{title:m?"Edit Sekolah":"Tambah Sekolah"}),e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-6","data-aos":"fade-down",children:[e.jsxs($,{href:v,className:"mb-4 inline-flex items-center text-sm text-base-content/70 hover:text-base-content",children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Kembali ke Daftar Sekolah"]}),e.jsx("h2",{className:"text-2xl font-bold",children:m?"Edit Sekolah":"Tambah Sekolah Baru"}),e.jsx("p",{className:"text-sm text-base-content/70",children:m?"Perbarui data sekolah":"Masukkan data sekolah yang akan ditambahkan"})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(_,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx(y,{children:e.jsx(w,{children:"Informasi Dasar"})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["NPSN ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",placeholder:"Masukkan NPSN",className:`input-bordered input w-full ${a.npsn?"input-error":""}`,value:n.npsn,onChange:l=>s("npsn",l.target.value),required:!0}),a.npsn&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.npsn})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nama Sekolah ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",placeholder:"Masukkan nama sekolah",className:`input-bordered input w-full ${a.nm_sekolah?"input-error":""}`,value:n.nm_sekolah,onChange:l=>s("nm_sekolah",l.target.value),required:!0}),a.nm_sekolah&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.nm_sekolah})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Kelurahan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${a.id_kelurahan?"select-error":""}`,value:n.id_kelurahan,onChange:l=>s("id_kelurahan",l.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Pilih Kelurahan"}),d.map(l=>e.jsxs("option",{value:l.id,children:[l.nm_kelurahan," - ",l.kecamatan?.nm_kecamatan]},l.id))]}),a.id_kelurahan&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.id_kelurahan})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Alamat ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("textarea",{rows:3,placeholder:"Masukkan alamat lengkap",className:`textarea-bordered textarea w-full ${a.alamat?"textarea-error":""}`,value:n.alamat,onChange:l=>s("alamat",l.target.value),required:!0}),a.alamat&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.alamat})})]})]})})]}),e.jsxs(_,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"200",children:[e.jsx(y,{children:e.jsx(w,{children:"Kontak"})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"No. Telepon"})}),e.jsx("input",{type:"text",placeholder:"Masukkan nomor telepon",className:`input-bordered input w-full ${a.no_telp?"input-error":""}`,value:n.no_telp,onChange:l=>s("no_telp",l.target.value)}),a.no_telp&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.no_telp})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Email"})}),e.jsx("input",{type:"email",placeholder:"Masukkan email",className:`input-bordered input w-full ${a.email?"input-error":""}`,value:n.email,onChange:l=>s("email",l.target.value)}),a.email&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.email})})]}),e.jsxs("div",{className:"form-control sm:col-span-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Website"})}),e.jsx("input",{type:"url",placeholder:"https://example.com",className:`input-bordered input w-full ${a.website?"input-error":""}`,value:n.website,onChange:l=>s("website",l.target.value)}),a.website&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.website})})]})]})})]}),e.jsxs(_,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"300",children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Koordinat Geografis"]})}),e.jsxs(S,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"mb-2 text-sm text-base-content/70",children:"Pilih lokasi sekolah di peta dengan menggeser marker atau klik pada peta. Koordinat akan otomatis terisi."})}),e.jsx("div",{className:"mb-4",children:e.jsx(B,{latitude:n.latitude,longitude:n.longitude,onLocationChange:(l,u)=>{s("latitude",l.toString()),s("longitude",u.toString())},height:"400px",sekolahs:p})}),p&&p.length>0&&e.jsxs("p",{className:"mb-2 text-xs text-base-content/60",children:[e.jsx("span",{className:"mr-1 inline-block h-3 w-3 rounded-full bg-blue-500"}),"Marker biru menunjukkan lokasi sekolah lain yang sudah terdaftar"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Latitude ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"number",step:"any",placeholder:"-2.5333",className:`input-bordered input w-full ${a.latitude?"input-error":""}`,value:n.latitude,onChange:l=>{s("latitude",l.target.value),l.target.value&&parseFloat(l.target.value)&&n.longitude&&parseFloat(n.longitude)},required:!0}),a.latitude&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.latitude})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Longitude ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"number",step:"any",placeholder:"140.7167",className:`input-bordered input w-full ${a.longitude?"input-error":""}`,value:n.longitude,onChange:l=>{s("longitude",l.target.value),l.target.value&&parseFloat(l.target.value)&&n.latitude&&parseFloat(n.latitude)},required:!0}),a.longitude&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.longitude})})]})]})]})]}),e.jsxs(_,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"400",children:[e.jsx(y,{children:e.jsx(w,{children:"Informasi Sekolah"})}),e.jsxs(S,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tahun Berdiri"})}),e.jsx("input",{type:"number",placeholder:"2000",min:"1900",max:new Date().getFullYear(),className:`input-bordered input w-full ${a.thn_berdiri?"input-error":""}`,value:n.thn_berdiri,onChange:l=>s("thn_berdiri",l.target.value)}),a.thn_berdiri&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.thn_berdiri})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Status Sekolah ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${a.status_sekolah?"select-error":""}`,value:n.status_sekolah,onChange:l=>s("status_sekolah",l.target.value),required:!0,children:[e.jsx("option",{value:"aktif",children:"Aktif"}),e.jsx("option",{value:"tidak_aktif",children:"Tidak Aktif"})]}),a.status_sekolah&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.status_sekolah})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Akreditasi ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${a.akreditasi?"select-error":""}`,value:n.akreditasi,onChange:l=>s("akreditasi",l.target.value),required:!0,children:[e.jsx("option",{value:"Belum",children:"Belum"}),e.jsx("option",{value:"A",children:"A"}),e.jsx("option",{value:"B",children:"B"}),e.jsx("option",{value:"C",children:"C"})]}),a.akreditasi&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.akreditasi})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tanggal Akreditasi"})}),e.jsx("input",{type:"date",className:`input-bordered input w-full ${a.tgl_akreditasi?"input-error":""}`,value:n.tgl_akreditasi,onChange:l=>s("tgl_akreditasi",l.target.value)}),a.tgl_akreditasi&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.tgl_akreditasi})})]})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Keterangan"})}),e.jsx("textarea",{rows:4,placeholder:"Masukkan keterangan tambahan (opsional)",className:`textarea-bordered textarea w-full ${a.ket?"textarea-error":""}`,value:n.ket,onChange:l=>s("ket",l.target.value)}),a.ket&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.ket})})]})]})]}),e.jsxs("div",{className:"bg-base flex justify-end gap-2","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx($,{href:v,children:e.jsx(C,{type:"button",variant:"outline",children:"Batal"})}),e.jsx(C,{type:"submit",variant:"primary",loading:g,children:m?"Perbarui":"Simpan"})]})]})]})]})}export{Y as default};
